#!/bin/bash
# ═══════════════════════════════════════════════════════════════════════════
# summon-team - パッショーネ複数メンバー同時召喚
# 使い方: summon-team <メンバー1> <メンバー2> ... "任務内容"
# ═══════════════════════════════════════════════════════════════════════════

set -e

# 引数が2つ未満ならヘルプ
if [[ $# -lt 2 ]]; then
    cat << 'EOF'
═══════════════════════════════════════════════════════════════════════════
  summon-team - パッショーネ複数メンバー同時召喚
═══════════════════════════════════════════════════════════════════════════

使い方:
  summon-team <メンバー1> <メンバー2> ... "任務内容"

例:
  summon-team fugo giorno "新機能を設計・実装しろ"
  summon-team fugo giorno abbacchio "認証機能を作ってレビューまで完了しろ"
  summon-team all "全員でプロジェクトを進めろ"

メンバー一覧:
  fugo      (フーゴ)      設計・計画
  giorno    (ジョルノ)    実装・開発
  abbacchio (アバッキオ)  検証・レビュー
  mista     (ミスタ)      監視・進捗確認
  narancia  (ナランチャ)  調査・リサーチ
  all       全員召喚
═══════════════════════════════════════════════════════════════════════════
EOF
    exit 0
fi

# 引数を解析
MEMBERS=()
MISSION=""

for arg in "$@"; do
    case "$arg" in
        fugo|giorno|abbacchio|mista|narancia|フーゴ|ジョルノ|アバッキオ|ミスタ|ナランチャ)
            MEMBERS+=("$arg")
            ;;
        all|全員)
            MEMBERS=("fugo" "giorno" "abbacchio" "mista" "narancia")
            ;;
        *)
            # 最後の引数が任務内容
            MISSION="$arg"
            ;;
    esac
done

if [[ -z "$MISSION" ]]; then
    echo "❌ 任務内容を指定してくれ"
    exit 1
fi

if [[ ${#MEMBERS[@]} -eq 0 ]]; then
    echo "❌ メンバーを指定してくれ"
    exit 1
fi

echo ""
echo "═══════════════════════════════════════════════════════════════════════════"
echo "  🎭 パッショーネ チーム召喚"
echo "═══════════════════════════════════════════════════════════════════════════"
echo ""
echo "📋 任務: $MISSION"
echo "👥 メンバー: ${MEMBERS[*]}"
echo ""
echo "───────────────────────────────────────────────────────────────────────────"

# 各メンバーを順次召喚（少し間を置いて）
for member in "${MEMBERS[@]}"; do
    echo ""
    echo "📣 $member を召喚中..."
    summon "$member" "$MISSION" &
    sleep 1  # ペインが開くのを待つ
done

echo ""
echo "═══════════════════════════════════════════════════════════════════════════"
echo "  ✅ 全メンバー召喚完了"
echo "  各ペインで作業風景を確認できる"
echo "═══════════════════════════════════════════════════════════════════════════"
